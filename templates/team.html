<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="icon" href="/static/images/bblogo.png">

	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

	<link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.6/css/responsive.dataTables.min.css" crossorigin="anonymous">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

	<title>NBA Shot Chart Visualization</title>

	<style id="plotly.js-style-global"></style><style type="text/css">/* Chart.js */
@keyframes chartjs-render-animation{from{opacity:.99}to{opacity:1}}.chartjs-render-monitor{animation:chartjs-render-animation 1ms}.chartjs-size-monitor,.chartjs-size-monitor-expand,.chartjs-size-monitor-shrink{position:absolute;direction:ltr;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1}.chartjs-size-monitor-expand>div{position:absolute;width:1000000px;height:1000000px;left:0;top:0}.chartjs-size-monitor-shrink>div{position:absolute;width:200%;height:200%;left:0;top:0}</style>
</head>

	<body data-new-gr-c-s-check-loaded="14.1006.0" data-gr-ext-installed="" class="d-flex h-100">
		<div class="container-fluid">
			<header class="mb-auto">
				<div class="container-fluid header-container">
					<h3 class="float-start">NBA Shot Chart Visualization</h3>
					<nav class="navbar navbar-expand-lg">
		      			<a class="nav-link selected-link" href="{{ url_for('handle_team') }}">Visualize</a>
				  	</nav>
				</div>
			</header>

			<main class="bd-content p-5" id="content" role="main">  
				<div class="container-fluid">
					<div class="row">
						<form action="{{ url_for('handle_team') }}" method="POST">
							<div class="row form-row">
								<div class="col-4 form-col">
								    <label for="teamSelect">Select team</label>
								    <select class="form-control" name="teamSelect" id="teamSelect">
								    	{% for team in all_teams %}
								    		<option>{{ team.full_name }} ({{ team.abbreviation }})</option>
								    	{% endfor %}
								    </select>
							  	</div>

							  	<!--
							    <div class="col form-col">
								    <label for="playerSelect">Select player</label>
								    <select class="form-control" name="playerSelect" id="playerSelect">
								    	{% for player in all_players %}
								    		<option>{{ player.full_name }}</option>
								    	{% endfor %}
								    </select>
							  	</div>
							  	-->

							  	<div class="col-3 form-col">
							  		<label for="timeSelect">Time span</label>
							  		<select class="form-control" name="timeSelect" id="timeSelect">
							  			<option selected>Season</option>
							  			<option>Time Period</option>
							  		</select>
							  	</div>

							  	<div class="col-2 form-col mr-auto" id="seasonCol">
							  		<label for="seasonSelect">Time span</label>
							  		<select class="form-control" name="seasonSelect" id="seasonSelect">
							  			<option selected>2020-21 (Current season)</option>
							  			<option>2019-20</option>
							  		</select>
							  	</div>

							  	<div class="col-2 form-col" id="timeStartCol">
							  		<label for="timeStart">From Date</label>
							  		<input type="date" class="form-control" name="timeStart" id="timeStart">
						  		</div>

						  		<div class="col-2 form-col mr-auto" id="timeEndCol">
							  		<label for="timeEnd">To Date</label>
							  		<input type="date" class="form-control" name="timeEnd" id="timeEnd">
						  		</div>

							  	<div class="col-1 form-col btn-col ml-auto">
							  		<button type="submit" class="btn btn-primary visualize-btn">Visualize</button>
							  	</div>
						  	</div>

						  	<div class="row form-row">
						  		<div class="col-4">
									<div class="form-check form-check-inline">
										<input class="form-check-input" name="location" type="checkbox" id="awayCheckbox" value="away" checked>
										<label class="form-check-label" for="awayCheckbox">Away Game</label>
									</div>
									<div class="form-check form-check-inline">
										<input class="form-check-input" name="location" type="checkbox" id="homeCheckbox" value="home" checked>
										<label class="form-check-label" for="homeCheckbox">Home Game</label>
									</div>
								</div>
								<div class="col-4">
									<div class="form-check form-check-inline">
										<input class="form-check-input" name="conference" type="checkbox" id="westCheckbox" value="westOppt" checked>
										<label class="form-check-label" for="westCheckbox">Western Conference Opponents</label>
									</div>
									<div class="form-check form-check-inline">
										<input class="form-check-input" name="conference" type="checkbox" id="eastCheckbox" value="eastOppt" checked>
										<label class="form-check-label" for="eastCheckbox">Eastern Conference Opponents</label>
									</div>
								</div>
						  	</div>
						</form>
					</div>

					<div class="row mt-4">
						<div class="col-lg-12 col-xl-6 mb-3">
							<div id="shotChart">
								<svg width="780" height="650" background-color="#122737">
									<g id="shotchart">
										<defs>
											<pattern id="bg" patternUnits="userSpaceOnUse" width="780" height="650">
												<img id="image-url" src="{{ url_for('static', filename='court.jpg') }}"  height="650"/>
											</pattern>
										</defs>
									</g>
								</svg>
							</div>

							<div id="tooltip" class="hidden">
								<p id="shotInfo">Information</p>
							</div>	
							<div id="chartLegend"></div>
						</div>

						<div class="col-lg-12 col-xl-6 mb-3">
							{% if data and data["team_average"] and data["league_average"] %}
								<div id="teamInfo">
									<h1>{{ data["team_name"] }} ({{ data["team_abbr"] }})</h1>

									{% if data["time_type"] == "Season" %}
										<h3>Season {{ data["season"] }}</h3>
									{% endif %}

									{% if data["time_type"] == "Time Period" %}
										<h3>From {{ data["date_from"] }} to {{ data["date_to"] }}</h3>
									{% endif %}

									{% if data["location"] %}
										<h5>{{ data["location"] }} Games</h5>
									{% else %}
										<h5>Home and Away Games</h5>
									{% endif %}

									{% if data["conference"] %}
										<h5>{{ data["conference"] }} Conference</h5>
									{% else %}
										<h5>East and West Conferences</h5>
									{% endif %}

									<table class="table average-table">
										<tr>
											<th class="text-left">FG-PCT</th>
											<th class="text-center">{{ data["team_abbr"] }}</th>
											<th class="text-center">League Average</th>
										</tr>
										<tr>
											<th class="text-left">2-PT</th>
											<td class="text-center">{{ data["team_average"]["two_point"]["FG_PCT"] }}%</td>
											<td class="text-center">{{ data["league_average"]["two_point"]["FG_PCT"] }}%</td>
										</tr>
										<tr>
											<th class="text-left">3-PT</th>
											<td class="text-center">{{ data["team_average"]["three_point"]["FG_PCT"] }}%</td>
											<td class="text-center">{{ data["league_average"]["three_point"]["FG_PCT"] }}%</td>
										</tr>
										<tr>
											<th class="text-left">Total</th>
											<td class="text-center">{{ data["team_average"]["total"]["FG_PCT"] }}%</td>
											<td class="text-center">{{ data["league_average"]["total"]["FG_PCT"] }}%</td>
										</tr>
									</table>
								</div>

								<form id="filterForm">
									<h3>Options and Filters</h3>
									<h5 class="filter-title">Chart Type</h5>
									<div class="form-check form-check-inline">
										<input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="shotChart" checked>
										<label class="form-check-label" for="inlineRadio1">Shot Chart</label>
									</div>
									<div class="form-check form-check-inline">
										<input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="heatMap">
										<label class="form-check-label" for="inlineRadio2">Heat Map</label>
									</div>

									<h5 class="filter-title">Shot Success</h5>
									<div class="form-check form-check-inline">
										<input class="form-check-input" name="success" type="checkbox" id="positionCheckbox1" value="made" checked>
										<label class="form-check-label" for="inlineCheckbox6">Made Shot</label>
									</div>
									<div class="form-check form-check-inline">
										<input class="form-check-input" name="success" type="checkbox" id="positionCheckbox2" value="missed" checked>
										<label class="form-check-label" for="inlineCheckbox7">Missed Shot</label>
									</div>

									<h5 class="filter-title">Quarter</h5>
									<div class="form-check form-check-inline">
										<input class="form-check-input" name="quarter" type="checkbox" id="inlineCheckbox1" value="1" checked>
										<label class="form-check-label" for="inlineCheckbox1">First</label>
									</div>
									<div class="form-check form-check-inline">
										<input class="form-check-input" name="quarter" type="checkbox" id="inlineCheckbox2" value="2" checked>
										<label class="form-check-label" for="inlineCheckbox2">Second</label>
									</div>
									<div class="form-check form-check-inline">
										<input class="form-check-input" name="quarter" type="checkbox" id="inlineCheckbox3" value="3" checked>
										<label class="form-check-label" for="inlineCheckbox3">Third</label>
									</div>
									<div class="form-check form-check-inline">
										<input class="form-check-input" name="quarter" type="checkbox" id="inlineCheckbox4" value="4" checked>
										<label class="form-check-label" for="inlineCheckbox4">Fourth</label>
									</div>
									<div class="form-check form-check-inline">
										<input class="form-check-input" name="quarter" type="checkbox" id="inlineCheckbox5" value="5" checked>
										<label class="form-check-label" for="inlineCheckbox5">Overtime</label>
									</div>

									<h5 class="filter-title">Shot Range</h5>
									<div class="form-check form-check-inline">
										<input class="form-check-input" name="range" type="checkbox" id="inlineCheckbox6" value="Paint" checked>
										<label class="form-check-label" for="inlineCheckbox6">In the paint (2-PTS)</label>
									</div>
									<div class="form-check form-check-inline">
										<input class="form-check-input" name="range" type="checkbox" id="inlineCheckbox7" value="Midrange" checked>
										<label class="form-check-label" for="inlineCheckbox7">Mid-range (2-PTS)</label>
									</div>
									<div class="form-check form-check-inline">
										<input class="form-check-input" name="range" type="checkbox" id="inlineCheckbox8" value="Three" checked>
										<label class="form-check-label" for="inlineCheckbox8">Over the arc (3-PTS)</label>
									</div>
								</form>
							{% endif %}
						</div>
					</div>

					<h3 class="plot-header">Performance by Categories</h3>	
					<div class="row">
						<div class="col-xl-6 plot-col" id="zoneVolPlot"><div id="zoneVolPlotTooltip" class="tooltip-plot hidden"></div></div>
						<div class="col-xl-6 plot-col" id="periodVolPlot"><div id="periodVolPlotTooltip" class="tooltip-plot hidden"></div></div>
					</div>

					<div class="row" id="plotLegend1"></div>

					<div class="row">
						<div class="col-xl-6 plot-col" id="zoneEffPlot"><div id="zoneEffPlotTooltip" class="tooltip-plot hidden"></div></div>
						<div class="col-xl-6 plot-col" id="periodEffPlot"><div id="periodEffPlotTooltip" class="tooltip-plot hidden"></div></div>
					</div>

					<div class="row">
						<h3 class="plot-header">Performance Comparison with Other Teams</h3>
						<div class="col-lg-12 col-xl-4 plot-col" id="twoPointPlot"><div id="twoPointPlotTooltip" class="tooltip-plot hidden"></div></div>
						<div class="col-lg-12 col-xl-4 plot-col" id="threePointPlot"><div id="threePointPlotTooltip" class="tooltip-plot hidden"></div></div>
						<div class="col-lg-12 col-xl-4 plot-col" id="totalPointPlot"><div id="totalPointPlotTooltip"class="tooltip-plot hidden"></div></div>
					</div>

					<div class="row" id="plotLegend2">

					</div>
				</div>
			</main>
		</div>

		<!-- JS -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/0.5.7/chartjs-plugin-annotation.min.js"></script>
		<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
		<script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
		<script src="https://cdn.datatables.net/responsive/2.2.6/js/dataTables.responsive.min.js"></script>
		<script src="https://d3js.org/d3.v6.min.js"></script>

		<script src="{{ url_for('static', filename='js/app.js') }}"	></script>

		<script>
			const teamConference = {
				"Atlanta Hawks": "East",
				"Boston Celtics": "East",
				"Cleveland Cavaliers": "East",
				"New Orleans Pelicans": "West",
				"Chicago Bulls": "East",
				"Dallas Mavericks": "West",
				"Denver Nuggets": "West",
				"Golden State Warriors": "West",
				"Houston Rockets": "West",
				"Los Angeles Clippers": "West",
				"Los Angeles Lakers": "West",
				"Miami Heat": "East",
				"Milwaukee Bucks": "East",
				"Minnesota Timberwolves": "West",
				"Brooklyn Nets": "East",
				"New York Knicks": "East",
				"Orlando Magic": "East",
				"Indiana Pacers": "East",
				"Philadelphia 76ers": "East",
				"Phoenix Suns": "West",
				"Portland Trail Blazers": "West",
				"Sacramento Kings": "West",
				"San Antonio Spurs": "West",
				"Oklahoma City Thunder": "West",
				"Toronto Raptors": "East",
				"Utah Jazz": "West",
				"Memphis Grizzlies": "West",
				"Washington Wizards": "East",
				"Detroit Pistons": "East",
				"Charlotte Hornets": "East"
			};

			$(function() {
				let shotsData = {{ data["shot_chart"]|tojson }};

				function loadShotChartSmall(playerData) {
					var max = { 
						x: 780, 
						y: 650
					};
					var svg = d3.select("#shotChart").html("");
					svg = d3.select("#shotChart").append("svg:svg")
					.attr("width", max.x)
					.attr("height", max.y)
					.attr("background-color", "#122737")
					.append("g")
					.attr("id", "shotchart");

					var courtUrl = "/court.jpg";
					svg.append("svg:defs")
					.append("svg:pattern")
					.attr("id", "bg")
					.attr('patternUnits', 'userSpaceOnUse')
					.attr("width", max.x)
					.attr("height", max.y)
					.append("svg:image")
					.attr("id","image-url")
					.attr("xlink:href", courtUrl)
					.attr("width", max.x)
					.attr("height", max.y);
					
					svg.append("rect")
					.attr("x", "0")
					.attr("y", "0")
					.attr("width", max.x)
					.attr("height", max.y)
					.attr("fill", "url(#bg)");
				  
					var xScale = d3.scaleLinear()
					.domain([-250, 250])
					.range([0, 780]);
				
					var yScale = d3.scaleLinear()
					.domain([-1,0, -150])
					.range([590,589, 371]);
				
					var colorValue = function(d) {
						if(d[10] === "Missed Shot") {
							return "#DC143C";
						} else  {
							return "#2E8B57";
						}
					}

					var xValue = function(d) {
						return xScale(-d[17]);
					}
				
					var yValue = function(d) {
						return (yScale(-d[18]));
					}

					var classByShot = function(d) {
						if(d[10] === "Missed Shot") {
							return "dot-missed";
						}
						if(d[10] === "Made Shot") {
							return "dot-made";
						}
					}

					var div = d3.select("body").append("div")	
										    .attr("class", "tooltip")				
										    .style("opacity", 0);
					d3.selectAll('dot').remove();
					var node = svg.selectAll("dot").data(playerData)
					node.enter()
					.append("svg:circle")
					.attr("r", 5)
					.attr("cx", function(d) { return  xValue(d);})
					.attr("cy", function(d) { return yValue(d);})
					.attr("class", function(d) { return classByShot(d);})
					.style("fill", function(d) { return colorValue(d);})
					.on("mouseover", function(e, d) {
						d3.select("#tooltip")			
							.select("#shotInfo")
							.html("<span><strong>" + d[4] + "</strong>, " + d[10] + ", Quarter: " + d[7] + ", Distance: " + d[16] + "ft.</span>");
				   	
						d3.select("#tooltip").classed("hidden", false);
				   })
				   .on("mouseout", function() {
						d3.select("#tooltip").classed("hidden", true);
				   });

				    // plot legend
					const svg1 = d3.select("#chartLegend")
								   .append("svg")
								   .attr("width", 780)
								   .attr("height", 50);

					svg1.append("circle").attr("cx", 250).attr("cy", 10).attr("r", 5).style("fill", "#DC143C").attr("stroke", "black").attr("stroke-width", 1);
					svg1.append("circle").attr("cx", 450).attr("cy", 10).attr("r", 5).style("fill", "#2E8B57").attr("stroke", "black").attr("stroke-width", 1);
					svg1.append("text").attr("x", 265).attr("y", 10).text("Made Shot").style("font-size", "16px").attr("alignment-baseline", "middle");
					svg1.append("text").attr("x", 465).attr("y", 10).text("Missed Shot").style("font-size", "16px").attr("alignment-baseline", "middle");
				};

				function loadShotChartMedium(playerData) {
					var max = { 
						x: 780, 
						y: 650
					};
					var svg = d3.select("#shotChart").html("");
					svg = d3.select("#shotChart").append("svg:svg")
					.attr("width", max.x)
					.attr("height", max.y)
					.attr("background-color", "#122737")
					.append("g")
					.attr("id", "shotchart");

					var courtUrl = "/court.jpg";
					svg.append("svg:defs")
					.append("svg:pattern")
					.attr("id", "bg")
					.attr('patternUnits', 'userSpaceOnUse')
					.attr("width", max.x)
					.attr("height", max.y)
					.append("svg:image")
					.attr("id","image-url")
					.attr("xlink:href", courtUrl)
					.attr("width", max.x)
					.attr("height", max.y);
					
					svg.append("rect")
					.attr("x", "0")
					.attr("y", "0")
					.attr("width", max.x)
					.attr("height", max.y)
					.attr("fill", "url(#bg)");

					svg.append("rect")
					   .attr("x", 4)
					   .attr("y", 455)
					   .attr("width", 46)
					   .attr("height", max.y - 455 - 4)
					   .style("fill", "red");

					svg.append("rect")
					   .attr("x", max.x - 51)
					   .attr("y", 455)
					   .attr("width", 46)
					   .attr("height", max.y - 455 - 4)
					   .style("fill", "blue");

					const outPoints = [[]]
				};

				loadShotChartSmall(shotsData);

				let filterData = shotsData;
				$("input[name='success']").on("click", function() {
					filteredData = filterShot(shotsData);
					loadShotChartSmall(filteredData);
				});

				$("input[name='quarter']").on("click", function() {
					filteredData = filterShot(shotsData);
					loadShotChartSmall(filteredData);
				});

				$("input[name='range']").on("click", function() {
					filteredData = filterShot(shotsData);
					loadShotChartSmall(filteredData);
				});

				function aggregateZone(data) {
					let column = 13;

					function f(acc, e) {
						if (e[column] in acc) {
							acc[e[column]]["FGA"]++;
							if (e[10] == "Made Shot") {
								acc[e[column]]["FGM"]++;
							}
						} else {
							acc[e[column]] = {
								"name": e[column],
								"FGA": 1,
								"FGM": 0
							}
							if (e[10] == "Made Shot") {
								acc[e[column]]["FGM"]++;
							}
						}
						return acc;
					}
					
					const aggDataObj = data.reduce(f, {});
					const aggDataArr = [];
					for (let key in aggDataObj) {
						aggDataObj[key]["Missed"] = aggDataObj[key]["FGA"] - aggDataObj[key]["FGM"];
						aggDataArr.push(aggDataObj[key]);
					}
					return aggDataArr;
				}

				function aggregatePeriod(data) {
					let column = 7;

					function f(acc, e) {
						const val = Math.min(5, parseInt(e[column]));
						if (val in acc) {
							acc[val]["FGA"]++;
							if (e[10] == "Made Shot") {
								acc[val]["FGM"]++;
							}
						} else {
							acc[e[column]] = {
								"name": e[column],
								"FGA": 1,
								"FGM": 0
							}
							if (e[10] == "Made Shot") {
								acc[val]["FGM"]++;
							}
						}
						return acc;
					}
					
					const aggDataObj = data.reduce(f, {});
					const aggDataArr = [];
					for (let key in aggDataObj) {
						aggDataObj[key]["Missed"] = aggDataObj[key]["FGA"] - aggDataObj[key]["FGM"];
						aggDataArr.push(aggDataObj[key]);
					}
					return aggDataArr;
				}

				function plotCategory(data) {
					const margin = {top: 10, right: 30, bottom: 60, left: 45 };
					const plotWidth = 900;
					const plotHeight = 400;

					function plotHelperVolume(aggFunc, id, title, xAxisFunc) {
						const aggData = aggFunc(data);

						const width = plotWidth - margin.left - margin.right;
    					const height = plotHeight - margin.top - margin.bottom;
						const svg = d3.select(id)
								  .append("svg")
								  .attr("width", plotWidth)
								  .attr("height", plotHeight)
								  .append("g")
								  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

						const xScale = d3.scaleBand()
										 .domain(aggData.map(d => { return xAxisFunc(d["name"]); }))
										 .range([0, width])
										 .padding(0.5);

						const yScale = d3.scaleLinear()
										 .domain([0, d3.max(aggData, d => { return d["FGA"]; })])
										 .range([height, 0]);


						// Title
						svg.append("text")
				           .attr("x", (width / 2))             
				           .attr("y", 0 + (margin.top / 3))
				           .attr("text-anchor", "middle")  
				           .style("font-size", "16px")
				           .style("font-weight", "bold")
				           .text(title);

						// X-axis
						svg.append("g")
						   .attr("transform", "translate(0," + height + ")")
	    				   .call(d3.axisBottom(xScale));
						
						// Y-axis
	    				svg.append("g")
	    				   .call(d3.axisLeft(yScale));

	    				svg.append("text")
					       .attr("transform", "rotate(-90)")
					       .attr("y", 0 - margin.left)
					       .attr("x", 0 - (height / 2))
					       .attr("dy", "1em")
					       .style("text-anchor", "middle")
					       .style("font-size", "16px") 
      					   .style("font-weight", "bold")
					       .text("Number of Shots");

					    const subgroups = ["FGM", "Missed"];

					    const colorScale = d3.scaleOrdinal()
											 .domain(subgroups)
											 .range(["#2E8B57", "#DC143C"]);

					    const stackedAggData = d3.stack().keys(subgroups)(aggData);

	    				svg.append("g")
	    				   .selectAll("g")
	    				   .data(stackedAggData)
	    				   .enter()
	    				   .append("g")
	    				   .attr("fill", function(d) { return colorScale(d.key); })
	    				   .selectAll("rect")
	    				   .data(function(d) { return d; })
	    				   .enter()
	    				   .append("rect")
	    				   .attr("x", function(d) { return xScale(xAxisFunc(d.data["name"])); })
					       .attr("y", function(d) { return yScale(d[1]); })
					       .attr("width", xScale.bandwidth())
					       .attr("height", function(d) { return yScale(d[0]) - yScale(d[1]); })
					       .on("mouseover", function(event, d)  {
					       		const xPosition = parseFloat(d3.select(this).attr("x")) + xScale.bandwidth() / 2;
								const yPosition = height / 2 + yScale(d[1] + d[0]) / 2;
								
								let tooltipHtml = "";
								if (d3.select(this).style("fill") == "rgb(220, 20, 60)") {
									tooltipHtml = "Attempts: " + d.data["FGA"] + "<br/>Missed: " + d.data["Missed"];
								} else {
									tooltipHtml = "Attempts: " + d.data["FGA"] + "<br/>Made: " + d.data["FGM"];
								}

								d3.select(id + "Tooltip")
								  .style("left", xPosition + "px")
								  .style("top", yPosition + "px")
								  .html(tooltipHtml);

						       	d3.select(id + "Tooltip").classed("hidden", false);
					       })
					       .on("mouseout", function(event, d) {
			   	  	  			d3.select(id + "Tooltip").classed("hidden", true);
					       });
					}

					function plotHelperEfficiency(aggFunc, id, title, xAxisFunc) {
						const aggData = aggFunc(data);

						const width = plotWidth - margin.left - margin.right;
    					const height = plotHeight - margin.top - margin.bottom;
						const svg = d3.select(id)
								  .append("svg")
								  .attr("width", plotWidth)
								  .attr("height", plotHeight)
								  .append("g")
								  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

						const xScale = d3.scaleBand()
										 .domain(aggData.map(d => { return xAxisFunc(d["name"]); }))
										 .range([0, width])
										 .padding(0.5);

						const yScale = d3.scaleLinear()
										 .domain([0, 100])
										 .range([height, 0]);

						// Title
						svg.append("text")
				           .attr("x", (width / 2))             
				           .attr("y", 0 + (margin.top / 3))
				           .attr("text-anchor", "middle")  
				           .style("font-size", "16px")
				           .style("font-weight", "bold")
				           .text(title);

						// X-axis
						svg.append("g")
						   .attr("transform", "translate(0," + height + ")")
	    				   .call(d3.axisBottom(xScale));
						
						// Y-axis
	    				svg.append("g")
	    				   .call(d3.axisLeft(yScale));

	    				svg.append("text")
					       .attr("transform", "rotate(-90)")
					       .attr("y", 0 - margin.left)
					       .attr("x", 0 - (height / 2))
					       .attr("dy", "1em")
					       .style("text-anchor", "middle")
					       .style("font-size", "16px") 
      					   .style("font-weight", "bold")
					       .text("Field Goal Percentage (%)");

	    				svg.selectAll(".bar")
	    				   .data(aggData)
	    				   .enter()
	    				   .append("rect")
	    				   .attr("x", function(d) { return xScale(xAxisFunc(d["name"])); })
					       .attr("y", function(d) { return yScale(d["FGM"] / d["FGA"] * 100); })
					       .attr("width", xScale.bandwidth())
					       .attr("height", function(d) { return height - yScale(d["FGM"] / d["FGA"] * 100); })
					       .style("fill", "steelblue")
					       .on("mouseover", function(event, d)  {
					       		const xPosition = parseFloat(d3.select(this).attr("x")) + xScale.bandwidth() / 2;
								const yPosition = parseFloat(d3.select(this).attr("y")) / 2 + height / 2;

								d3.select(id + "Tooltip")
								  .style("left", xPosition + "px")
								  .style("top", yPosition + "px")
								  .html("FGA: " + d["FGA"] + "<br/>FGM: " + d["FGM"] + "<br/>FG-PCT: " + Math.round(d["FGM"] / d["FGA"] * 100, 2) + "%");

						       	d3.select(id + "Tooltip").classed("hidden", false);
					       })
					       .on("mouseout", function(event, d) {
			   	  	  			d3.select(id + "Tooltip").classed("hidden", true);
					       });
					}

					function periodTitleFunc(t) {
						if (t == 5) {
							return "Overtime (OT)";
						} else {
							return "Quarter " + t.toString();
						}
					};

					plotHelperVolume(aggregateZone, "#zoneVolPlot", "Shooting Volume", t => t);
					plotHelperVolume(aggregatePeriod, "#periodVolPlot", "Shooting Volume", periodTitleFunc);
					plotHelperEfficiency(aggregateZone, "#zoneEffPlot", "Shooting Efficiency", t => t);
					plotHelperEfficiency(aggregatePeriod, "#periodEffPlot", "Shooting Efficiency", t => t);

					// Plot legend
					const svg1 = d3.select("#plotLegend1")
								   .append("svg")
								   .attr("width", plotWidth * 2)
								   .attr("height", 50);

					svg1.append("rect").attr("x", 800).attr("y", 10).attr("width", 25).attr("height", 10).style("fill", "#2E8B57").attr("stroke", "black").attr("stroke-width", 1);
					svg1.append("rect").attr("x", 950).attr("y", 10).attr("width", 25).attr("height", 10).style("fill", "#DC143C").attr("stroke", "black").attr("stroke-width", 1);
					svg1.append("text").attr("x", 830).attr("y", 17).text("Made Shot").style("font-size", "16px").attr("alignment-baseline", "middle");
					svg1.append("text").attr("x", 980).attr("y", 17).text("Missed Shot").style("font-size", "16px").attr("alignment-baseline", "middle");
				}

				plotCategory(shotsData);

				function prepareData(teamName, teamAverage, otherAverages) {
					let data = [];
					for (let team in otherAverages) {
						data.push({
							"name": team,
							"average": otherAverages[team]
						})
					}

					data.push({
						name: teamName,
						average: teamAverage
					});
					return data; 
				}

				function plotAverage(teamName, teamAverage, otherAverages) {
					const data = prepareData(teamName, teamAverage, otherAverages);

					const margin = {top: 10, right: 30, bottom: 60, left: 45 };
					const plotWidth = 600;
					const plotHeight = 400;

					function plotOne(id, key) {
						const width = plotWidth - margin.left - margin.right;
    					const height = plotHeight - margin.top - margin.bottom;
						const svg = d3.select(id)
								  .append("svg")
								  .attr("width", plotWidth)
								  .attr("height", plotHeight)
								  .append("g")
								  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

						const xScale = d3.scaleLinear()
										 .domain([d3.min(data, d => { return d["average"][key]["FGA"] - 200; }), d3.max(data, d => { return d["average"][key]["FGA"] + 200; })])
										 .range([0, width]);

						const yScale = d3.scaleLinear()
										 .domain([100, 0])
										 .range([0, height]);

						// Title
						let title = "";
						switch(key) {
							case "two_point":
								title = "2-PTS FGA vs. FG PCT Plot";
								break;
							case "three_point":
								title = "3-PTS FGA vs. FG PCT Plot";
								break;
							case "total":
								title = "Total FGA vs. FG PCT Plot";
								break;
						}
						svg.append("text")
				           .attr("x", (width / 2))             
				           .attr("y", 0 + (margin.top / 3))
				           .attr("text-anchor", "middle")  
				           .style("font-size", "16px")
				           .style("font-weight", "bold")
				           .text(title);

						// X-axis
						svg.append("g")
						   .attr("transform", "translate(0," + height + ")")
	    				   .call(d3.axisBottom(xScale));

	    				svg.append("text")
	    				   .attr("transform",  "translate(" + (width / 2) + " ," + (height + margin.top + 20) + ")")
      					   .style("text-anchor", "middle")
      					   .style("font-size", "16px") 
      					   .style("font-weight", "bold")
      					   .text("Field Goal Attempts (Number of Shots)");
						
						// Y-axis
	    				svg.append("g")
	    				   .call(d3.axisLeft(yScale));

					    svg.append("text")
					       .attr("transform", "rotate(-90)")
					       .attr("y", 0 - margin.left)
					       .attr("x", 0 - (height / 2))
					       .attr("dy", "1em")
					       .style("text-anchor", "middle")
					       .style("font-size", "16px") 
      					   .style("font-weight", "bold")
					       .text("Field Goal Percentage (%)");

	    				svg.append("g")
	    				   .selectAll("dot")
	    				   .data(data)
	    				   .enter()
	    				   .append("circle")
	    				   .attr("cx", function (d) { return xScale(d["average"][key]["FGA"]); })
					       .attr("cy", function (d) { return yScale(d["average"][key]["FG_PCT"]); })
					       .attr("r", 6)
       					   .attr("stroke", "black")
  						   .attr("stroke-width", 1)
					       .style("fill", function(d) {
					       		if (d["name"] === teamName) {
					       			return "#228B22";
					       		} else {
					       			if (teamConference[d["name"]] === "West") {
					       				return "#8B0000";
					       			} else {
					       				return "#000099";
					       			}
					       		}
					       })
					       .on("mouseover", function(event, d) {
					       		d3.select(this).attr("r", 10);

			   	  	  			const xPosition = parseFloat(d3.select(this).attr("cx"));
								const yPosition = parseFloat(d3.select(this).attr("cy"));
								
								d3.select(id + "Tooltip")
								  .style("left", (xPosition - 40) + "px")
								  .style("top", (yPosition - 50) + "px")
								  .html("<strong>" + d["name"] + "</strong><br/>FGA: " + d["average"][key]["FGA"] + "<br/>FGM: " + d["average"][key]["FGM"] + "<br/>FG-PCT: " + d["average"][key]["FG_PCT"] + "%");

						       	d3.select(id + "Tooltip").classed("hidden", false);
					       })
					       .on("mouseout", function(event, d) {
					       		d3.select(this).attr("r", 6);

			   	  	  			d3.select(id + "Tooltip").classed("hidden", true);
					       })

						const total_fga = data.reduce((acc, elem) => acc + elem["average"][key]["FGA"], 0);
						const avg_fga = total_fga / data.length;
						const total_fgm = data.reduce((acc, elem) => acc + elem["average"][key]["FGM"], 0);
						const avg_pct = total_fgm / total_fga * 100;
					    
					    // League average FGA
					    svg.append("line")
					       .attr("x1", xScale(avg_fga))
					       .attr("y1", 0)
					       .attr("x2", xScale(avg_fga))
					       .attr("y2", height)
					       .style("stroke-width", 1)
						   .style("stroke", "black")
						   .style("fill", "black");

						svg.append("text")
						   .attr("transform", "rotate(90)")
	    				   .attr("y", 0 - xScale(avg_fga) - 5)
					       .attr("x", 0 + 15)
      					   .style("text-anchor", "left")
      					   .style("font-size", "9px")
      					   .text("average FGA");

						// League average FG-PCT
						svg.append("line")
						   .attr("x1", 0)
						   .attr("y1", yScale(avg_pct))
						   .attr("x2", width)
						   .attr("y2", yScale(avg_pct))
					       .style("stroke-width", 1)
						   .style("stroke", "black")
						   .style("fill", "black");

						svg.append("text")
	    				   .attr("transform",  "translate(" + 15 + " ," + (yScale(avg_pct) - 5) + ")")
      					   .style("text-anchor", "left")
      					   .style("font-size", "9px")
      					   .text("average FG-PCT");
					}

					plotOne("#twoPointPlot", "two_point");
					plotOne("#threePointPlot", "three_point");
					plotOne("#totalPointPlot", "total");

					const svg = d3.select("#plotLegend2")
								  .append("svg")
								  .attr("width", plotWidth * 3)
								  .attr("height", 50);

					svg.append("circle").attr("cx", 650).attr("cy", 25).attr("r", 6).style("fill", "#228B22").attr("stroke", "black").attr("stroke-width", 1);
					svg.append("circle").attr("cx", 800).attr("cy", 25).attr("r", 6).style("fill", "#8B0000").attr("stroke", "black").attr("stroke-width", 1);
					svg.append("circle").attr("cx", 1000).attr("cy", 25).attr("r", 6).style("fill", "#000099").attr("stroke", "black").attr("stroke-width", 1);
					svg.append("text").attr("x", 665).attr("y", 25).text(teamName).style("font-size", "16px").attr("alignment-baseline", "middle");
					svg.append("text").attr("x", 815).attr("y", 25).text("Western Conference").style("font-size", "16px").attr("alignment-baseline", "middle");
					svg.append("text").attr("x", 1015).attr("y", 25).text("Eastern Conference").style("font-size", "16px").attr("alignment-baseline", "middle");
				}

				plotAverage({{ data["team_name"]|tojson }}, {{ data["team_average"]|tojson }}, {{ data["other_averages"]|tojson }});
		  	});
		</script>

		<script>
		</script>
	</body>
</html>